<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Impostor Gamee</title>
</head>
<body>
    <h1>Impostor Gamee</h1>

    <input id="name" placeholder="Enter your name" />
    <button id="join">Join</button>

    <h3>Players</h3>
    <ul id="players"></ul>

    <div style="position:fixed;top:10px;right:10px">
        <input id="hostPass" type="password" placeholder="Host password">
        <button onclick="hostLogin()">Login</button>
    </div>

    <button id="startBtn" style="display:none" onclick="startGame()">
        Start Game
    </button>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
    // const BACKEND_URL = "https://imposter-backend-ch3h.onrender.com";
    // let socket = io(BACKEND_URL, { transports: ["websocket"] });

    const BACKEND_URL = location.hostname === "localhost" ? "http://localhost:5001": "https://imposter-backend-ch3h.onrender.com";
    const socket = io(BACKEND_URL);

    const playersList = document.getElementById("players");
    const joinBtn = document.getElementById("join");    

    function hostLogin() {
        socket.emit("host_login", {
            password: document.getElementById("hostPass").value
        });
    }

    socket.on("host_login_result", data => {
        if (data.success) {
            document.getElementById("startBtn").style.display = "block";
            alert("Logged in as host");
        } else {
            alert("Wrong password");
        }
    });

    joinBtn.onclick = () => {
        const name = document.getElementById("name").value.trim();
        if (!name) return;

        socket.emit("join", { name });
        joinBtn.disabled = true;
    };

    socket.on("players_update", (players) => {
        playersList.innerHTML = "";
        players.forEach(p => {
            const li = document.createElement("li");
            li.textContent = p;
            playersList.appendChild(li);
        });
    });

    function startGame() {
        socket.emit("start_game");
    }

    socket.on("role", data => {
        alert("Your role: " + data.role);
    });
    </script>
</body>
</html>